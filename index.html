<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador de Punto de Equilibrio y Rentabilidad</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    background-color: #f9f9f9;
    color: #222;
}
header {
    background-color: #001f3f;
    color: white;
    padding: 1rem;
    text-align: center;
}
.container {
    max-width: 1200px;
    margin: 2rem auto;
    background-color: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.15);
}
h2 {
    color: #800020; /* vino tinto */
    border-bottom: 2px solid #ffcc00; /* mostaza */
    padding-bottom: .5rem;
}
input, select {
    padding: .4rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 100%;
}
button {
    background-color: #001f3f;
    color: white;
    border: none;
    border-radius: 6px;
    padding: .6rem 1.2rem;
    cursor: pointer;
}
button:hover {
    background-color: #800020;
}
.table-container {
    overflow-x: auto;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
}
th, td {
    border: 1px solid #ccc;
    padding: .5rem;
    text-align: center;
}
th {
    background-color: #ffcc00;
    color: #001f3f;
}
.interpretacion {
    margin-top: 1rem;
    font-weight: bold;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
}
.verde { background-color: #d4edda; color: #155724; }
.rojo { background-color: #f8d7da; color: #721c24; }
.amarillo { background-color: #fff3cd; color: #856404; }
</style>
</head>
<body>
<header>
    <h1 id="titulo">Simulador de Punto de Equilibrio y Rentabilidad</h1>
    <button onclick="cambiarIdioma()">üåê Espa√±ol / English</button>
</header>

<div class="container">
    <h2 id="titulo_datos">Datos del Producto</h2>
    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;">
        <div>
            <label id="lblProducto">Nombre del producto:</label>
            <input type="text" id="nombreProducto">
        </div>
        <div>
            <label id="lblCostoVar">Costo variable unitario:</label>
            <input type="number" id="costoVariable" step="0.01">
        </div>
        <div>
            <label id="lblMetodo">M√©todo de precio:</label>
            <select id="metodoPrecio">
                <option value="manual">Manual</option>
                <option value="margen">Por margen</option>
                <option value="mercado">Por mercado</option>
            </select>
        </div>
        <div>
            <label id="lblPrecio">Precio de venta unitario / Margen deseado (%):</label>
            <input type="number" id="precioVenta" step="0.01">
        </div>
    </div>

    <h2 id="titulo_costos">Costos fijos</h2>
    <div id="costosFijosContainer"></div>
    <button onclick="agregarCostoFijo()" id="btnAgregarCosto">+ Agregar Costo Fijo</button>

    <h2 id="titulo_ventas">Volumen de ventas estimado</h2>
    <input type="number" id="volumenVentas" step="1" value="1000">

    <button onclick="agregarProducto()" style="margin-top:1rem;" id="btnAgregarProd">Agregar producto</button>

    <div class="table-container">
        <table id="tablaResultados">
            <thead>
                <tr>
                    <th id="thProducto">Producto</th>
                    <th id="thMargen">Margen contribuci√≥n</th>
                    <th id="thPEu">P.E. unidades</th>
                    <th id="thPEv">P.E. valor</th>
                    <th id="thUtilidad">Utilidad estimada</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <canvas id="grafico" style="margin-top:2rem;height:300px;"></canvas>

    <div id="interpretacion" class="interpretacion"></div>

    <div style="margin-top:2rem;">
        <button onclick="guardarDatos()" id="btnGuardar">Guardar datos</button>
        <button onclick="cargarDatos()" id="btnCargar">Cargar datos</button>
        <button onclick="limpiar()" id="btnLimpiar">Limpiar</button>
    </div>
</div>

<script>
let idioma = "es";
let productos = [];
let costosFijos = [];

function cambiarIdioma() {
    idioma = (idioma === "es") ? "en" : "es";
    const textos = {
        es: {
            titulo: "Simulador de Punto de Equilibrio y Rentabilidad",
            titulo_datos: "Datos del Producto",
            titulo_costos: "Costos fijos",
            titulo_ventas: "Volumen de ventas estimado",
            lblProducto: "Nombre del producto:",
            lblCostoVar: "Costo variable unitario:",
            lblMetodo: "M√©todo de precio:",
            lblPrecio: "Precio de venta unitario / Margen deseado (%):",
            btnAgregarCosto: "+ Agregar Costo Fijo",
            btnAgregarProd: "Agregar producto",
            thProducto: "Producto",
            thMargen: "Margen contribuci√≥n",
            thPEu: "P.E. unidades",
            thPEv: "P.E. valor",
            thUtilidad: "Utilidad estimada",
            btnGuardar: "Guardar datos",
            btnCargar: "Cargar datos",
            btnLimpiar: "Limpiar"
        },
        en: {
            titulo: "Break-Even and Profitability Simulator",
            titulo_datos: "Product Data",
            titulo_costos: "Fixed Costs",
            titulo_ventas: "Estimated Sales Volume",
            lblProducto: "Product name:",
            lblCostoVar: "Unit variable cost:",
            lblMetodo: "Pricing method:",
            lblPrecio: "Unit price / Desired margin (%):",
            btnAgregarCosto: "+ Add Fixed Cost",
            btnAgregarProd: "Add product",
            thProducto: "Product",
            thMargen: "Contribution Margin",
            thPEu: "Break-even (units)",
            thPEv: "Break-even (value)",
            thUtilidad: "Expected profit",
            btnGuardar: "Save data",
            btnCargar: "Load data",
            btnLimpiar: "Clear"
        }
    };
    for (let id in textos[idioma]) {
        document.getElementById(id).textContent = textos[idioma][id];
    }
}

function agregarCostoFijo() {
    const div = document.createElement("div");
    const input = document.createElement("input");
    input.type = "number";
    input.placeholder = idioma === "es" ? "Costo fijo" : "Fixed cost";
    input.step = "0.01";
    input.classList.add("costoFijo");
    div.appendChild(input);
    document.getElementById("costosFijosContainer").appendChild(div);
}

function obtenerCostosFijosTotales() {
    let total = 0;
    document.querySelectorAll(".costoFijo").forEach(c => total += parseFloat(c.value) || 0);
    return total;
}

function agregarProducto() {
    const nombre = document.getElementById("nombreProducto").value;
    const costoVariable = parseFloat(document.getElementById("costoVariable").value);
    const metodo = document.getElementById("metodoPrecio").value;
    const precioInput = parseFloat(document.getElementById("precioVenta").value);
    const volumen = parseFloat(document.getElementById("volumenVentas").value);
    const costosFijosTotales = obtenerCostosFijosTotales();

    if (!nombre || isNaN(costoVariable) || isNaN(precioInput)) {
        alert("Complete todos los campos num√©ricos.");
        return;
    }

    let precioVenta;
    if (metodo === "margen") {
        precioVenta = costoVariable / (1 - (precioInput / 100));
    } else {
        precioVenta = precioInput;
    }

    const margenContrib = precioVenta - costoVariable;
    const peUnidades = costosFijosTotales / margenContrib;
    const peValor = peUnidades * precioVenta;
    const utilidad = (precioVenta - costoVariable) * volumen - costosFijosTotales;

    productos.push({ nombre, margenContrib, peUnidades, peValor, utilidad });

    actualizarTabla();
    actualizarGrafico();
    mostrarInterpretacion(utilidad, costosFijosTotales);
}

function formatoMoneda(valor) {
    return valor.toLocaleString("es-EC", { style: "currency", currency: "USD" });
}

function actualizarTabla() {
    const tbody = document.querySelector("#tablaResultados tbody");
    tbody.innerHTML = "";
    productos.forEach(p => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
            <td>${p.nombre}</td>
            <td>${formatoMoneda(p.margenContrib)}</td>
            <td>${p.peUnidades.toFixed(2)}</td>
            <td>${formatoMoneda(p.peValor)}</td>
            <td>${formatoMoneda(p.utilidad)}</td>
        `;
        tbody.appendChild(fila);
    });
}

let chart;
function actualizarGrafico() {
    const ctx = document.getElementById("grafico");
    const labels = productos.map(p => p.nombre);
    const ingresos = productos.map(p => p.peValor);
    const utilidad = productos.map(p => p.utilidad);
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
        type: "bar",
        data: {
            labels,
            datasets: [
                { label: idioma === "es" ? "P.E. valor" : "Break-even value", data: ingresos, backgroundColor: "#001f3f" },
                { label: idioma === "es" ? "Utilidad" : "Profit", data: utilidad, backgroundColor: "#ffcc00" }
            ]
        },
        options: { responsive: true, plugins: { legend: { position: "bottom" } } }
    });
}

function mostrarInterpretacion(utilidad) {
    const div = document.getElementById("interpretacion");
    if (utilidad > 0) {
        div.textContent = idioma === "es" ? "El negocio est√° por encima del punto de equilibrio (Ganancia)" : "The business is above break-even (Profit)";
        div.className = "interpretacion verde";
    } else if (utilidad === 0) {
        div.textContent = idioma === "es" ? "El negocio est√° en punto de equilibrio" : "The business is at break-even";
        div.className = "interpretacion amarillo";
    } else {
        div.textContent = idioma === "es" ? "El negocio est√° por debajo del punto de equilibrio (P√©rdida)" : "The business is below break-even (Loss)";
        div.className = "interpretacion rojo";
    }
}

function guardarDatos() {
    localStorage.setItem("productos", JSON.stringify(productos));
    alert("Datos guardados.");
}

function cargarDatos() {
    const data = JSON.parse(localStorage.getItem("productos") || "[]");
    productos = data;
    actualizarTabla();
    actualizarGrafico();
}

function limpiar() {
    productos = [];
    document.querySelector("#tablaResultados tbody").innerHTML = "";
    if (chart) chart.destroy();
    document.getElementById("interpretacion").textContent = "";
}
</script>
</body>
</html>
