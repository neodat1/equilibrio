<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Profesional - Punto de Equilibrio</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a1f4f;
            --primary-light: #2d3480;
            --secondary: #8c1c13;
            --secondary-light: #a42d25;
            --accent: #2e7d32;
            --light-bg: #f8f9fa;
            --dark-text: #2c3e50;
            --border: #e0e0e0;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark-text);
            line-height: 1.6;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--primary);
            color: white;
            padding: 30px 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 600;
        }
        
        .nav-section {
            margin-bottom: 30px;
        }
        
        .nav-title {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            opacity: 0.7;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            background: var(--primary-light);
        }
        
        .nav-item:hover:not(.active) {
            background: rgba(255,255,255,0.05);
        }
        
        .nav-icon {
            margin-right: 12px;
            font-size: 18px;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-left: 15px;
        }
        
        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--light-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 20px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-text);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 31, 79, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: var(--secondary-light);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--dark-text);
        }
        
        .btn-outline:hover {
            background: var(--light-bg);
        }
        
        .btn-icon {
            margin-right: 8px;
        }
        
        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: var(--light-bg);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark-text);
            border-bottom: 1px solid var(--border);
        }
        
        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .data-table tr:hover {
            background: #f9f9f9;
        }
        
        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-top: 30px;
        }
        
        .result-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .kpi-card {
            text-align: center;
            padding: 30px 20px;
        }
        
        .kpi-value {
            font-size: 42px;
            font-weight: 700;
            color: var(--primary);
            margin: 15px 0;
        }
        
        .kpi-label {
            font-size: 16px;
            color: #666;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 25px;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background: #e8f5e9;
            color: var(--success);
        }
        
        .badge-warning {
            background: #fff8e1;
            color: var(--warning);
        }
        
        .badge-danger {
            background: #ffebee;
            color: var(--danger);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">üìä</div>
                <div class="logo-text">Finanzas Pro</div>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">An√°lisis Principal</div>
                <div class="nav-item active">
                    <div class="nav-icon">‚öñÔ∏è</div>
                    <div>Punto de Equilibrio</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">üíπ</div>
                    <div>An√°lisis de Rentabilidad</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">üìà</div>
                    <div>Proyecciones</div>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">Herramientas</div>
                <div class="nav-item">
                    <div class="nav-icon">üí∞</div>
                    <div>Calculadora de Precios</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">üìã</div>
                    <div>Plantillas</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">üõ†Ô∏è</div>
                    <div>Configuraci√≥n</div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="page-title">Simulador de Punto de Equilibrio</div>
                <div class="user-menu">
                    <div>Administrador</div>
                    <div class="user-avatar">A</div>
                </div>
            </div>
            
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" data-tab="costos">Costos Fijos</div>
                <div class="tab" data-tab="productos">Productos</div>
                <div class="tab" data-tab="analisis">An√°lisis</div>
                <div class="tab" data-tab="reportes">Reportes</div>
            </div>
            
            <!-- Costos Fijos Tab -->
            <div class="tab-content active" id="costos">
                <div class="dashboard">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Registro de Costos Fijos</div>
                            <div class="card-icon">üí∞</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Concepto del Costo</label>
                            <input type="text" class="form-control" id="costoConcepto" placeholder="Ej: Alquiler, N√≥mina, Servicios...">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Monto Mensual ($)</label>
                                <input type="number" class="form-control" id="costoMonto" placeholder="0.00" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Categor√≠a</label>
                                <select class="form-control" id="costoCategoria">
                                    <option value="operativos">Operativos</option>
                                    <option value="administrativos">Administrativos</option>
                                    <option value="comerciales">Comerciales</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" id="agregarCosto">
                            <span class="btn-icon">+</span> Agregar Costo Fijo
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Costos Fijos Registrados</div>
                            <div class="card-icon">üìã</div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Concepto</th>
                                        <th>Categor√≠a</th>
                                        <th>Monto Mensual</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaCostos">
                                    <!-- Los costos se agregar√°n aqu√≠ din√°micamente -->
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="2"><strong>Total</strong></td>
                                        <td id="totalCostos"><strong>$0.00</strong></td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn btn-primary" id="siguienteProductos">
                                Siguiente: Productos
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Productos Tab -->
            <div class="tab-content" id="productos">
                <div class="dashboard">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Registro de Productos</div>
                            <div class="card-icon">üì¶</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Nombre del Producto</label>
                            <input type="text" class="form-control" id="productoNombre" placeholder="Ej: Producto A, Servicio B...">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Costo Variable Unitario ($)</label>
                                <input type="number" class="form-control" id="productoCosto" placeholder="0.00" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Categor√≠a</label>
                                <select class="form-control" id="productoCategoria">
                                    <option value="producto">Producto</option>
                                    <option value="servicio">Servicio</option>
                                    <option value="suscripcion">Suscripci√≥n</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" id="agregarProducto">
                            <span class="btn-icon">+</span> Agregar Producto
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Productos Registrados</div>
                            <div class="card-icon">üìä</div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Categor√≠a</th>
                                        <th>Costo Unitario</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaProductos">
                                    <!-- Los productos se agregar√°n aqu√≠ din√°micamente -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn btn-outline" id="volverCostos">
                                Anterior: Costos
                            </button>
                            <button class="btn btn-primary" id="siguienteAnalisis">
                                Siguiente: An√°lisis
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- An√°lisis Tab -->
            <div class="tab-content" id="analisis">
                <div class="dashboard">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Configuraci√≥n de An√°lisis</div>
                            <div class="card-icon">‚öôÔ∏è</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Seleccionar Producto</label>
                            <select class="form-control" id="productoAnalisis">
                                <option value="">-- Seleccione un producto --</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">M√©todo de Precio</label>
                            <select class="form-control" id="metodoPrecio">
                                <option value="manual">Precio Manual</option>
                                <option value="margen">Por Margen de Contribuci√≥n</option>
                            </select>
                        </div>
                        
                        <div id="grupoPrecioManual">
                            <div class="form-group">
                                <label class="form-label">Precio de Venta Unitario ($)</label>
                                <input type="number" class="form-control" id="precioUnitario" placeholder="0.00" min="0" step="0.01">
                            </div>
                        </div>
                        
                        <div id="grupoMargen" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Margen de Contribuci√≥n Deseado (%)</label>
                                <input type="number" class="form-control" id="margenContribucion" placeholder="0.00" min="0" max="100" step="0.01">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Cantidad Estimada a Vender (unidades)</label>
                            <input type="number" class="form-control" id="cantidadEstimada" placeholder="0" min="0" step="1">
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-secondary" id="calcularPuntoEquilibrio">
                                Calcular Punto de Equilibrio
                            </button>
                            <button class="btn btn-primary" id="agregarResumen">
                                Agregar al Resumen
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Resultados del An√°lisis</div>
                            <div class="card-icon">üìà</div>
                        </div>
                        
                        <div id="resultadosAnalisis">
                            <div style="text-align: center; padding: 40px; color: #999;">
                                Complete la configuraci√≥n y haga clic en "Calcular" para ver los resultados
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Results Grid -->
                <div class="results-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Resumen General</div>
                            <div class="card-icon">üìã</div>
                        </div>
                        
                        <div id="resumenGeneral">
                            <div style="text-align: center; padding: 40px; color: #999;">
                                Agregue productos al resumen para ver el an√°lisis consolidado
                            </div>
                        </div>
                    </div>
                    
                    <div class="card kpi-card">
                        <div class="card-title">Punto de Equilibrio General</div>
                        <div class="kpi-value" id="kpiEquilibrio">$0</div>
                        <div class="kpi-label">Ingresos necesarios para cubrir costos</div>
                        <div class="badge badge-warning" style="margin-top: 15px;">Pendiente de c√°lculo</div>
                    </div>
                </div>
            </div>
            
            <!-- Reportes Tab -->
            <div class="tab-content" id="reportes">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Reporte de Punto de Equilibrio</div>
                        <div class="card-icon">üìÑ</div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="graficoEquilibrio"></canvas>
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; gap: 10px;">
                        <button class="btn btn-primary">
                            <span class="btn-icon">üì•</span> Exportar PDF
                        </button>
                        <button class="btn btn-outline">
                            <span class="btn-icon">üìä</span> Exportar Datos
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let costosFijos = [];
        let productos = [];
        let resumenAnalisis = [];
        let chart = null;
        
        // Navegaci√≥n entre pesta√±as
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remover clase active de todas las pesta√±as
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Agregar clase active a la pesta√±a clickeada
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Cambio de m√©todo de precio
        document.getElementById('metodoPrecio').addEventListener('change', function() {
            const metodo = this.value;
            document.getElementById('grupoPrecioManual').style.display = 
                metodo === 'manual' ? 'block' : 'none';
            document.getElementById('grupoMargen').style.display = 
                metodo === 'margen' ? 'block' : 'none';
        });
        
        // Agregar costo fijo
        document.getElementById('agregarCosto').addEventListener('click', function() {
            const concepto = document.getElementById('costoConcepto').value.trim();
            const monto = parseFloat(document.getElementById('costoMonto').value);
            const categoria = document.getElementById('costoCategoria').value;
            
            if (!concepto || isNaN(monto) || monto <= 0) {
                alert('Por favor complete todos los campos correctamente');
                return;
            }
            
            costosFijos.push({ concepto, monto, categoria });
            actualizarTablaCostos();
            
            // Limpiar formulario
            document.getElementById('costoConcepto').value = '';
            document.getElementById('costoMonto').value = '';
        });
        
        // Actualizar tabla de costos
        function actualizarTablaCostos() {
            const tbody = document.getElementById('tablaCostos');
            let total = 0;
            
            tbody.innerHTML = '';
            
            costosFijos.forEach((costo, index) => {
                total += costo.monto;
                
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${costo.concepto}</td>
                    <td><span class="badge badge-outline">${costo.categoria}</span></td>
                    <td>$${costo.monto.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-outline" onclick="editarCosto(${index})" style="padding: 5px 10px; font-size: 12px;">Editar</button>
                        <button class="btn btn-outline" onclick="eliminarCosto(${index})" style="padding: 5px 10px; font-size: 12px;">Eliminar</button>
                    </td>
                `;
                
                tbody.appendChild(fila);
            });
            
            document.getElementById('totalCostos').innerHTML = `<strong>$${total.toFixed(2)}</strong>`;
        }
        
        // Editar costo
        function editarCosto(index) {
            const costo = costosFijos[index];
            document.getElementById('costoConcepto').value = costo.concepto;
            document.getElementById('costoMonto').value = costo.monto;
            document.getElementById('costoCategoria').value = costo.categoria;
            
            costosFijos.splice(index, 1);
            actualizarTablaCostos();
        }
        
        // Eliminar costo
        function eliminarCosto(index) {
            if (confirm('¬øEst√° seguro de que desea eliminar este costo?')) {
                costosFijos.splice(index, 1);
                actualizarTablaCostos();
            }
        }
        
        // Agregar producto
        document.getElementById('agregarProducto').addEventListener('click', function() {
            const nombre = document.getElementById('productoNombre').value.trim();
            const costo = parseFloat(document.getElementById('productoCosto').value);
            const categoria = document.getElementById('productoCategoria').value;
            
            if (!nombre || isNaN(costo) || costo <= 0) {
                alert('Por favor complete todos los campos correctamente');
                return;
            }
            
            productos.push({ nombre, costo, categoria });
            actualizarTablaProductos();
            actualizarSelectProductos();
            
            // Limpiar formulario
            document.getElementById('productoNombre').value = '';
            document.getElementById('productoCosto').value = '';
        });
        
        // Actualizar tabla de productos
        function actualizarTablaProductos() {
            const tbody = document.getElementById('tablaProductos');
            
            tbody.innerHTML = '';
            
            productos.forEach((producto, index) => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${producto.nombre}</td>
                    <td><span class="badge badge-outline">${producto.categoria}</span></td>
                    <td>$${producto.costo.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-outline" onclick="editarProducto(${index})" style="padding: 5px 10px; font-size: 12px;">Editar</button>
                        <button class="btn btn-outline" onclick="eliminarProducto(${index})" style="padding: 5px 10px; font-size: 12px;">Eliminar</button>
                    </td>
                `;
                
                tbody.appendChild(fila);
            });
        }
        
        // Actualizar select de productos para an√°lisis
        function actualizarSelectProductos() {
            const select = document.getElementById('productoAnalisis');
            select.innerHTML = '<option value="">-- Seleccione un producto --</option>';
            
            productos.forEach(producto => {
                const option = document.createElement('option');
                option.value = producto.nombre;
                option.textContent = `${producto.nombre} ($${producto.costo.toFixed(2)})`;
                select.appendChild(option);
            });
        }
        
        // Editar producto
        function editarProducto(index) {
            const producto = productos[index];
            document.getElementById('productoNombre').value = producto.nombre;
            document.getElementById('productoCosto').value = producto.costo;
            document.getElementById('productoCategoria').value = producto.categoria;
            
            productos.splice(index, 1);
            actualizarTablaProductos();
            actualizarSelectProductos();
        }
        
        // Eliminar producto
        function eliminarProducto(index) {
            if (confirm('¬øEst√° seguro de que desea eliminar este producto?')) {
                productos.splice(index, 1);
                actualizarTablaProductos();
                actualizarSelectProductos();
            }
        }
        
        // Navegaci√≥n entre pesta√±as
        document.getElementById('siguienteProductos').addEventListener('click', function() {
            if (costosFijos.length === 0) {
                alert('Debe agregar al menos un costo fijo para continuar');
                return;
            }
            
            document.querySelector('.tab.active').classList.remove('active');
            document.querySelector('.tab-content.active').classList.remove('active');
            
            document.querySelector('[data-tab="productos"]').classList.add('active');
            document.getElementById('productos').classList.add('active');
        });
        
        document.getElementById('volverCostos').addEventListener('click', function() {
            document.querySelector('.tab.active').classList.remove('active');
            document.querySelector('.tab-content.active').classList.remove('active');
            
            document.querySelector('[data-tab="costos"]').classList.add('active');
            document.getElementById('costos').classList.add('active');
        });
        
        document.getElementById('siguienteAnalisis').addEventListener('click', function() {
            if (productos.length === 0) {
                alert('Debe agregar al menos un producto para continuar');
                return;
            }
            
            document.querySelector('.tab.active').classList.remove('active');
            document.querySelector('.tab-content.active').classList.remove('active');
            
            document.querySelector('[data-tab="analisis"]').classList.add('active');
            document.getElementById('analisis').classList.add('active');
        });
        
        // Calcular punto de equilibrio
        document.getElementById('calcularPuntoEquilibrio').addEventListener('click', function() {
            const productoNombre = document.getElementById('productoAnalisis').value;
            const metodo = document.getElementById('metodoPrecio').value;
            const cantidadEstimada = parseInt(document.getElementById('cantidadEstimada').value) || 0;
            
            if (!productoNombre) {
                alert('Por favor seleccione un producto');
                return;
            }
            
            const producto = productos.find(p => p.nombre === productoNombre);
            if (!producto) return;
            
            let precioUnitario;
            
            if (metodo === 'manual') {
                precioUnitario = parseFloat(document.getElementById('precioUnitario').value);
                if (isNaN(precioUnitario) || precioUnitario <= 0) {
                    alert('Por favor ingrese un precio unitario v√°lido');
                    return;
                }
            } else {
                const margen = parseFloat(document.getElementById('margenContribucion').value);
                if (isNaN(margen) || margen < 0 || margen >= 100) {
                    alert('Por favor ingrese un margen de contribuci√≥n v√°lido (0-100%)');
                    return;
                }
                
                // Calcular precio basado en margen: Precio = Costo / (1 - Margen/100)
                precioUnitario = producto.costo / (1 - margen/100);
                document.getElementById('precioUnitario').value = precioUnitario.toFixed(2);
            }
            
            // Calcular resultados
            const costosFijosTotales = costosFijos.reduce((sum, costo) => sum + costo.monto, 0);
            const margenContribucion = precioUnitario - producto.costo;
            const puntoEquilibrioUnidades = Math.ceil(costosFijosTotales / margenContribucion);
            const puntoEquilibrioValor = puntoEquilibrioUnidades * precioUnitario;
            
            // Mostrar resultados
            const resultadosDiv = document.getElementById('resultadosAnalisis');
            resultadosDiv.innerHTML = `
                <div class="results-grid">
                    <div class="result-card">
                        <div class="card-title">An√°lisis de ${producto.nombre}</div>
                        <div class="kpi-value">${puntoEquilibrioUnidades.toLocaleString()}</div>
                        <div class="kpi-label">Unidades para punto de equilibrio</div>
                        
                        <div style="margin-top: 25px;">
                            <div class="form-row">
                                <div class="detail-box">
                                    <div class="detail-label">Precio Unitario</div>
                                    <div class="detail-value">$${precioUnitario.toFixed(2)}</div>
                                </div>
                                <div class="detail-box">
                                    <div class="detail-label">Costo Unitario</div>
                                    <div class="detail-value">$${producto.costo.toFixed(2)}</div>
                                </div>
                            </div>
                            
                            <div class="form-row" style="margin-top: 15px;">
                                <div class="detail-box">
                                    <div class="detail-label">Margen de Contribuci√≥n</div>
                                    <div class="detail-value">$${margenContribucion.toFixed(2)}</div>
                                </div>
                                <div class="detail-box">
                                    <div class="detail-label">Punto Equilibrio ($)</div>
                                    <div class="detail-value">$${puntoEquilibrioValor.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="card-title">Estado de Rentabilidad</div>
                        <div style="text-align: center; margin: 20px 0;">
                            ${cantidadEstimada >= puntoEquilibrioUnidades ? 
                                '<div class="badge badge-success" style="font-size: 16px; padding: 10px 20px;">RENTABLE</div>' : 
                                '<div class="badge badge-danger" style="font-size: 16px; padding: 10px 20px;">NO RENTABLE</div>'}
                        </div>
                        
                        <div class="detail-box" style="margin-top: 20px;">
                            <div class="detail-label">Unidades estimadas vs. equilibrio</div>
                            <div class="detail-value">${cantidadEstimada} / ${puntoEquilibrioUnidades}</div>
                        </div>
                        
                        <div class="detail-box" style="margin-top: 15px;">
                            <div class="detail-label">Diferencia</div>
                            <div class="detail-value">${cantidadEstimada - puntoEquilibrioUnidades} unidades</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Guardar datos para el resumen
            window.productoActual = {
                nombre: producto.nombre,
                precio: precioUnitario,
                costo: producto.costo,
                margenContribucion: margenContribucion,
                puntoEquilibrioUnidades: puntoEquilibrioUnidades,
                puntoEquilibrioValor: puntoEquilibrioValor,
                cantidadEstimada: cantidadEstimada
            };
        });
        
        // Agregar al resumen general
        document.getElementById('agregarResumen').addEventListener('click', function() {
            if (!window.productoActual) {
                alert('Primero debe calcular el punto de equilibrio para un producto');
                return;
            }
            
            // Verificar si el producto ya est√° en el resumen
            const index = resumenAnalisis.findIndex(p => p.nombre === window.productoActual.nombre);
            if (index !== -1) {
                resumenAnalisis[index] = window.productoActual;
            } else {
                resumenAnalisis.push(window.productoActual);
            }
            
            actualizarResumenGeneral();
        });
        
        // Actualizar resumen general
        function actualizarResumenGeneral() {
            const resumenDiv = document.getElementById('resumenGeneral');
            
            if (resumenAnalisis.length === 0) {
                resumenDiv.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        Agregue productos al resumen para ver el an√°lisis consolidado
                    </div>
                `;
                return;
            }
            
            let tablaHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Precio</th>
                            <th>Costo</th>
                            <th>Margen</th>
                            <th>Pto. Eq. (Unid.)</th>
                            <th>Pto. Eq. ($)</th>
                            <th>Cant. Estimada</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            let ingresoTotal = 0;
            let contribucionTotal = 0;
            
            resumenAnalisis.forEach(producto => {
                const estado = producto.cantidadEstimada >= producto.puntoEquilibrioUnidades ? 
                    '<span class="badge badge-success">Rentable</span>' : 
                    '<span class="badge badge-danger">No Rentable</span>';
                
                tablaHTML += `
                    <tr>
                        <td>${producto.nombre}</td>
                        <td>$${producto.precio.toFixed(2)}</td>
                        <td>$${producto.costo.toFixed(2)}</td>
                        <td>$${producto.margenContribucion.toFixed(2)}</td>
                        <td>${producto.puntoEquilibrioUnidades.toLocaleString()}</td>
                        <td>$${producto.puntoEquilibrioValor.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                        <td>${producto.cantidadEstimada.toLocaleString()}</td>
                        <td>${estado}</td>
                    </tr>
                `;
                
                ingresoTotal += producto.precio * producto.cantidadEstimada;
                contribucionTotal += producto.margenContribucion * producto.cantidadEstimada;
            });
            
            tablaHTML += `</tbody></table>`;
            
            // Calcular punto de equilibrio general
            const costosFijosTotales = costosFijos.reduce((sum, costo) => sum + costo.monto, 0);
            const puntoEquilibrioGeneral = costosFijosTotales / (contribucionTotal / ingresoTotal);
            const utilidad = contribucionTotal - costosFijosTotales;
            
            // Actualizar KPI
            document.getElementById('kpiEquilibrio').textContent = `$${puntoEquilibrioGeneral.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
            
            let estadoGeneral = '';
            if (utilidad > 0) {
                estadoGeneral = '<div class="badge badge-success" style="margin-top: 15px;">GANANCIA</div>';
            } else if (utilidad === 0) {
                estadoGeneral = '<div class="badge badge-warning" style="margin-top: 15px;">EQUILIBRIO</div>';
            } else {
                estadoGeneral = '<div class="badge badge-danger" style="margin-top: 15px;">P√âRDIDA</div>';
            }
            
            resumenDiv.innerHTML = tablaHTML + `
                <div style="margin-top: 25px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="detail-box">
                        <div class="detail-label">Ingreso Total Estimado</div>
                        <div class="detail-value">$${ingresoTotal.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                    </div>
                    <div class="detail-box">
                        <div class="detail-label">Contribuci√≥n Total</div>
                        <div class="detail-value">$${contribucionTotal.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                    </div>
                    <div class="detail-box">
                        <div class="detail-label">Costos Fijos Totales</div>
                        <div class="detail-value">$${costosFijosTotales.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                    </div>
                    <div class="detail-box">
                        <div class="detail-label">Utilidad Estimada</div>
                        <div class="detail-value">$${utilidad.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    ${estadoGeneral}
                </div>
            `;
            
            // Actualizar gr√°fico
            actualizarGrafico();
        }
        
        // Actualizar gr√°fico
        function actualizarGrafico() {
            const ctx = document.getElementById('graficoEquilibrio').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            // Datos de ejemplo para el gr√°fico
            const unidades = [0, 50, 100, 150, 200, 250, 300];
            const costosFijosTotales = costosFijos.reduce((sum, costo) => sum + costo.monto, 0);
            
            // Calcular costos e ingresos para el gr√°fico
            const costosTotales = unidades.map(u => {
                let costosVariables = 0;
                resumenAnalisis.forEach(producto => {
                    costosVariables += producto.costo * u;
                });
                return costosFijosTotales + costosVariables;
            });
            
            const ingresosTotales = unidades.map(u => {
                let ingresos = 0;
                resumenAnalisis.forEach(producto => {
                    ingresos += producto.precio * u;
                });
                return ingresos;
            });
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: unidades,
                    datasets: [
                        {
                            label: 'Costos Totales',
                            data: costosTotales,
                            borderColor: '#8c1c13',
                            backgroundColor: 'rgba(140, 28, 19, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Ingresos Totales',
                            data: ingresosTotales,
                            borderColor: '#1a1f4f',
                            backgroundColor: 'rgba(26, 31, 79, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'An√°lisis de Punto de Equilibrio'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Unidades Vendidas'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Valor ($)'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Agregar algunos datos de ejemplo
            costosFijos = [
                { concepto: 'Alquiler', monto: 2000, categoria: 'operativos' },
                { concepto: 'N√≥mina', monto: 5000, categoria: 'operativos' },
                { concepto: 'Servicios', monto: 500, categoria: 'operativos' }
            ];
            
            productos = [
                { nombre: 'Producto A', costo: 15, categoria: 'producto' },
                { nombre: 'Producto B', costo: 25, categoria: 'producto' },
                { nombre: 'Servicio C', costo: 40, categoria: 'servicio' }
            ];
            
            actualizarTablaCostos();
            actualizarTablaProductos();
            actualizarSelectProductos();
        });
    </script>
</body>
</html>
